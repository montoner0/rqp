# Really Quick Player 1.0

Really Quick Player (RQP) - это плагин для [Far Manager](https://www.farmanager.com/), позволяющий удобно работать с аудио файлами: производить предпрослушивание и отбор нужных/отсеивание ненужных файлов.

Отличие его от аналогичных плагинов - ориентация именно на работу с файлами в рамках Far, а не попытка сделать еще один полнофункциональный плеер. Поэтому в нем нет плейлистов, эквалайзеров и других функций, которые просто не нужны при отборе файлов. Зато в нем есть другие функции, которые сильно упрощают жизнь при разборе завалов музыки:

- возможность выделения проигрываемых файлов на панели,
- демо-режим, в котором треки играются частично,
- добавление файлов в плейлист (или запуск воспроизведения) во внешнем плеере.

# Установка

Плагин устанавливается, как и любой другой плагин Far - путем создания подпапки в папке с остальными плагинами и распаковки в нее архива с RQP.

Также, для работы требуется:
- Библиотека [BASS 2.4](www.un4seen.com), dll которой должна располагаться рядом с dll плагина (битностью должна совпадать с битностью плагина), а дополнительные плагины BASS - в подпапке `bassplugs` (плагины ищутся по расширению dll, если хочется использовать плагины от qPlayEx - придется их переименовать).
- Для чтения тегов из аудио файлов плагину требуется библиотека tags.dll (включена в поставку)
- Для воспроизведения MIDI файлов, помимо субплагина к BASS, требуется банк сэмплов в формате SF2/SFZ. Найти его можно в интернете, после чего положить в папку `%windir%\System32` (и `SysWOW64` для х64 ОС).

При первом запуске плагин ищет настройки от юникодной версии (для Far2) в реестре и импортирует их.

# Известные проблемы

* Т. к. переход по файлам внутри архива в текущей версии Far API невозможен, то в RQP пришлось его сделать через "хак", подсмотренный у PicView. Как следствие - возможны глюки.

# Пытливым умам aka Techinfo

Помимо настроек, изменяемых через интерфейс плеера, есть некоторое количество настроек, доступных только при ручном редактировании базы, в том числе, отвечающие за внешний вид. Например, символы, из которых "строятся" ползунки, цвета и т. д.

Т. к. стандартного способа редактирования базы настроек плагинов Far 3, насколько мне ивестно, нет, то предлагается это делать через файлы `.Farconfig`. В папке плагина есть пример `RQP_Def.Farconfig`, содержащий настройки по умолчанию. Его можно исправить и через ключ `/import` скормить Far'у.

Краткое описание параметров, не изменяемых через интерфейс плеера:

| Настройка | Описание |
| ---------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ButtonsChars | Символы, отображаемые на "кнопках" плеера |
| Colors | Цвета диалога плеера (см. ниже подробности) |
| PanSliderChars | Символы, из которых создается ползунок баланса |
| PosSliderChars | Символы, из которых создается ползунок позиции |
| RedrawPanels | Флаг, отвечающий за перерисовку панелей при перемещении по файлам и их выделении. По большому счету - устарел и не нужен |
| TagsTemplate | Шаблон, по которому формируется строка тегов. Его описание можно посмотреть в документации к [tags.dll](http://www.un4seen.com) |
| VisibleLinesMask | Маска видимых частей плеера (см. ниже) |
| VolSliderChars | Символы, из которых создается ползунок громкости |
| DescriptionFile | Имя файла, в котором сохраняются описания. Путь может быть как абсолютный, так относительный, поддерживаются переменные окружения |
| AutoLoop | Включает режим, в котором, при проигрывании OGG файлов с тегом `ANDROID_LOOP=true` (как правило, это рингтоны для Андроида), режим повтора  включается автоматически |
| FirstRun | Если его нет, то RQP ищет в реестре настройки от версии для Far2 и импортирует их |

Формат большинства параметров очевиден, поэтому расскажу о неочевидных:

- Цвета задаются массивом байт, каждый байт задает цвет фона (старшие 4 бита) и текста (младшие 4 бита) части интерфейса. Порядок цветов такой: основной фон диалога, кнопка, подсвеченная кнопка, текст, выделенный текст, полоски уровней, ползунок громкости, ползунок баланса, ползунок позиции, время, рамка, заголовок и 2 зарезервированных на будущее.
- Количество символов, которыми рисуется ползунок громкости (в отличие от других ползунков) м. б. не обязательно 3, а от 1 до 15 (не считая символа "пустого места").
- Параметр VisibleLinesMask позволяет активизировать так называемый "минирежим", в котором отображаются только те строки интерфейса плеера, биты которых заданы в параметре. По умолчанию, режим выключен (все биты установлены в 1). Значащими являются 8 младших бит параметра (по количеству строк интерфейса, рамка не учитывается), 0-й бит отвечает за первую (верхнюю) строку.
- С помощью `RQP_Unicode.farconfig` можно настроить альтернативные Unicode символы для интерфейса. Для корректного отображния потребуется шрифт, который их содержит (рекомендуется [FiraCode NF](https://github.com/ryanoasis/nerd-fonts/releases)).

# Сборка

Для сборки плагина требуются:
- Файлы библиотеки BASS в папке `lib\bass`. По меньшей мере, требуется сама библиотека и tags.dll.
- Файлы `DlgBuilder.hpp`, `farcolor.hpp` и `plugin.hpp` (они - часть Far plugin SDK) в папке `lib\Farapi3`.

# Ссылки

[Тема плагина на форуме Far Manager](http://forum.Farmanager.com/viewtopic.php?f=11&t=5000)

[Обсуждение на форуме Far Manager](https://forum.farmanager.com/viewtopic.php?p=57628)

[Плагин на PlugRing](https://plugring.farmanager.com/plugin.php?pid=863)

# Legal

Плагин поставляется "как есть". Автор не несет ответственности за любые проблемы, возникшие в результате использования или не использования данного плагина.

Copyright (c) 2010-2023 [montonero](https://github.com/montoner0/rqp)

BASS Audio Library: Copyright (c) 1999-2023 [Un4seen Developments Ltd.](http://www.un4seen.com)
